{% extends "base.html" %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 mb-md-4 gap-2">
  <div>
    <h2 class="mb-1">Transactions üí∏</h2>
    <p class="text-muted mb-0">
      Manage your income and expenses. Add, edit, or remove records below.
    </p>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-sm">
      ‚Üê Back to dashboard
    </a>
    <a href="{{ url_for('export_csv') }}" class="btn btn-outline-primary btn-sm">
      ‚¨áÔ∏è Export CSV
    </a>
  </div>
</div>

<div class="row g-4">
  <!-- Add Transaction Form -->
  <div class="col-12 col-lg-4">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">Add New Transaction</h5>
        <form method="post">
          <div class="mb-3">
            <label class="form-label small fw-semibold text-muted">Date</label>
            <input type="date" class="form-control" name="date">
          </div>

          <div class="mb-3">
            <label class="form-label small fw-semibold text-muted">Description</label>
            <input type="text" class="form-control" name="description" placeholder="e.g. Grocery shopping" required>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-6">
              <label class="form-label small fw-semibold text-muted">Type</label>
              <select class="form-select" name="type">
                <option value="income">Income</option>
                <option value="expense">Expense</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label small fw-semibold text-muted">Amount</label>
              <input type="number" step="0.01" class="form-control" name="amount" placeholder="e.g. 120.00" required>
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label small fw-semibold text-muted">Category</label>
            <select class="form-select" name="category_id" required>
              {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>

          <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold">
            ‚ûï Add Transaction
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Transaction List -->
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Transaction History</h5>
          <small class="text-muted">
            Total: {{ transactions|length }} record{{ 's' if transactions|length != 1 }}
          </small>
        </div>

        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Category</th>
                <th class="text-end">Amount</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
            {% for tx in transactions %}
              <tr>
                <td class="text-nowrap">{{ tx.date.strftime("%b %d, %Y") }}</td>
                <td>{{ tx.description }}</td>
                <td>
                  <span class="badge bg-secondary-subtle text-dark border">{{ tx.category.name }}</span>
                </td>
                <td class="text-end">
                  <span class="fw-semibold {{ 'text-success' if tx.amount > 0 else 'text-danger' }}">
                    {{ '+' if tx.amount > 0 else '-' }}{{ "%.2f"|format(tx.amount|abs) }}
                  </span>
                </td>
                <td class="text-end">
                  <div class="d-flex justify-content-end gap-2">
                    <a href="{{ url_for('edit_transaction', tx_id=tx.id) }}"
                       class="btn btn-outline-secondary btn-sm px-3">
                      ‚úèÔ∏è Edit
                    </a>
                    <form method="post"
                          action="{{ url_for('delete_transaction', tx_id=tx.id) }}"
                          onsubmit="return confirm('Are you sure you want to delete this transaction?');">
                      <button type="submit" class="btn btn-outline-danger btn-sm px-3">
                        üóëÔ∏è Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  No transactions yet. Add your first one on the left üí∞
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
